"""add campus_id and eval_source

Revision ID: 0aa283a71cd1
Revises: 20260102_01
Create Date: 2026-01-04 21:41:06.804782

"""
from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa
from sqlalchemy.dialects import mysql

# revision identifiers, used by Alembic.
revision: str = '0aa283a71cd1'
down_revision: Union[str, Sequence[str], None] = '20260102_01'
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    """Upgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.add_column('college', sa.Column('campus_id', mysql.TINYINT(), nullable=True, comment='校区ID（1-南宁 2-桂林，可空）'))
    op.create_index(op.f('ix_college_campus_id'), 'college', ['campus_id'], unique=False)
    op.add_column('teaching_evaluation', sa.Column('eval_source', sa.String(length=16), nullable=True, comment='评教来源（peer/supervisor，可空）'))
    op.create_index(op.f('ix_teaching_evaluation_eval_source'), 'teaching_evaluation', ['eval_source'], unique=False)
    op.alter_column('timetable', 'course_type',
               existing_type=mysql.VARCHAR(collation='utf8mb4_unicode_ci', length=32),
               comment='待评，已评',
               existing_comment='课程类型（可空：必修/选修/实训...）',
               existing_nullable=True)
    # ### end Alembic commands ###


def downgrade() -> None:
    """Downgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.alter_column('timetable', 'course_type',
               existing_type=mysql.VARCHAR(collation='utf8mb4_unicode_ci', length=32),
               comment='课程类型（可空：必修/选修/实训...）',
               existing_comment='待评，已评',
               existing_nullable=True)
    op.drop_index(op.f('ix_teaching_evaluation_eval_source'), table_name='teaching_evaluation')
    op.drop_column('teaching_evaluation', 'eval_source')
    op.drop_index(op.f('ix_college_campus_id'), table_name='college')
    op.drop_column('college', 'campus_id')
    # ### end Alembic commands ###
