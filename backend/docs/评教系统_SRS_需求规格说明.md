# 评教系统完整需求规格说明（SRS）

- 文档版本：v1.0
- 生成日期：2026-01-03
- 依据：《评教系统需求与功能分析.docx》（外部文件）+ 你提供的文字需求与截图标注

## 目录

- 1. 引言
- 2. 角色权限总览
- 3. 界面与交互统一规范
- 4. 功能需求
- 5. 系统共性需求
- 6. 数据与接口需求（概要）
- 7. 非功能性需求
- 8. 验收与测试要点
- 9. 风险、假设与待确认项
- 10. 开发进度同步单（迭代计划）

---

## 1. 引言

### 1.1 文档目的

- 作为评教系统需求的“单一事实来源”，用于对齐产品/开发/测试/验收口径。
- 将你提供的《评教系统需求与功能分析》内容（文字+截图标注）结构化为：
  - 角色边界
  - 功能清单（含功能编号）
  - 统一交互规范
  - 验收标准
  - 开发进度同步单（便于逐项推进）

### 1.2 系统范围（系统要解决什么）

评教系统用于支撑“听课评教”业务闭环，核心包含：

- 课表查看
  - 普通教师：仅个人课表
  - 管理员：按学院/全校查看教师课表
  - 督导：以“听课评教”为目的进行筛选定位
- 听课评教
  - 待评课程获取（按角色范围限制）
  - 提交评教（表单/评分/匿名策略/编号生成）
  - 查看已评课程
  - 查看收到的评教
- 统计分析
  - 个人（我收到/我提交）
  - 学院（听课任务完成度、督导结果统计、排名/分布）
  - 全校（同学院口径，但扩展到全校）
- 管理与督导
  - 学院/学校管理员对听课记录、督导评教进行查看/编辑/导出
  - 督导具备强筛选能力（按时间/学院/教师快速定位课程）

### 1.3 目标用户

- 普通教师
- 督导教师
- 学院管理员
- 学校管理员

### 1.4 术语与定义

- **课表（Timetable）**：课程排课记录，包含课程、授课教师、上课时间、周次、地点、班级等信息。
- **授课教师**：课表中的教师（Timetable.teacher_id）。
- **听课教师/评教人**：提交评教的人（listen_teacher）。
- **待评课程**：对当前登录者而言尚未提交评教的课程集合。
- **已评课程**：对当前登录者而言已提交评教的课程集合。
- **收到的评教**：对授课教师而言，别人对其课程的评教集合。
- **周次**：教学周（1..N），用于按周渲染与筛选。
- **星期（天次）**：一..日（1..7）。
- **节次/大节**：一天内的上课时间段（例如“第五大节”）。

### 1.5 外部系统与运行环境

- **客户端**：微信小程序（uni-app）
- **后端**：FastAPI + MySQL（异步 SQLAlchemy）
- **数据来源**：强智教务系统导入/同步（教室编号、课表、班级等）

### 1.6 关键业务规则（必须满足）

- **禁止自评**：不能评教自己授课的课程。
- **范围约束**：
  - 普通教师：只能看到/评教本学院授课教师的课程。
  - 督导教师：可评教全校课程，但必须提供强筛选，避免全量列表不可用。
  - 学院管理员：仅本学院。
  - 学校管理员：全校。
- **实时更新**：提交评教后，“待评/已评/总评”等数量和列表需立即联动更新。
- **时间口径一致**：所有统计与列表必须明确“学年/学期/周次”口径，默认口径必须清晰。

---

## 2. 角色权限总览

### 2.1 角色能力概述

| 角色 | 权限描述 |
| --- | --- |
| 普通教师（教研室互评身份） | 查看个人课表；对本人所属教研室范围内教师课程进行评教；查看收到的评教；统计自身数据 |
| 院级督导（督导身份） | 查看个人课表；对本学院内“指定教研室范围”的课程筛选评教；查看收到的评教；查看督导统计 |
| 校级督导（督导身份） | 查看个人课表；对全校课程筛选评教；查看收到的评教；查看全校维度督导统计 |
| 学院管理员 | 管理本学院教师听课记录；查看本学院全部教师课表；查看本学院所有被听评教 |
| 学校管理员 | 管理全校教师听课记录与督导评教；查看全校课表；进行全局统计 |

### 2.2 数据范围（强约束）

- **重要**：同一用户可能同时具备多重身份（例如：既是普通教师，又是院级/校级督导）。系统必须支持“身份切换”，并以“当前激活身份（active_identity）”决定：
  - 可评范围
  - 待评课程口径
  - 统计口径
  - 前台/后台模块入口可见性

- **普通教师（教研室互评身份）**
  - 待评课程：仅本人所属教研室（research_room_id）范围内授课教师的课程
  - 收到评教：仅自己授课课程被评教的数据
  - 我提交的评教：仅自己提交的评教记录

- **院级督导（督导身份）**
  - 待评课程：本学院范围内，并且限制在“督导被授权的教研室集合”内
  - 授权范围：由管理员配置（可配置多个教研室；默认不授权则不可评教）
  - 页面必须“先筛选再展示”，默认不允许直接拉取学院全量课程

- **校级督导（督导身份）**
  - 待评课程：全校范围
  - 页面必须“先筛选再展示”，默认不允许直接拉取全校全量课程

- **学院管理员**：本学院（college_id）范围
- **学校管理员**：全校范围

### 2.3 权限矩阵（功能级）

| 功能模块 | 普通教师（教研室互评） | 院级督导 | 校级督导 | 学院管理员 | 学校管理员 |
| --- | --- | --- | --- | --- | --- |
| 身份切换（多重身份） | 读/切换 | 读/切换 | 读/切换 | - | - |
| 全局学年学期切换 | 读/切换 | 读/切换 | 读/切换 | 读/切换 | 读/切换 |
| 首页数据看板 | 读 | 读 | 读 | 读 | 读 |
| 个人课表 | 读 | 读 | 读 | - | - |
| 学院课表 | - | - | - | 读 | 读（可按学院筛选） |
| 全校课表 | - | - | - | - | 读 |
| 评教“选择/筛选”流程 | 读（教研室范围） | 读（授权教研室范围） | 读（全校筛选） | 读（学院范围筛选） | 读（全校范围筛选） |
| 提交评教 | 写（教研室范围） | 写（授权教研室范围） | 写（全校筛选后） | - | - |
| 我提交的评教 | 读（本人） | 读（本人） | 读（本人） | 读（学院范围） | 读（全校范围） |
| 收到的评教 | 读（本人） | 读（本人） | 读（本人） | 读（学院范围，含督导） | 读（全校范围） |
| 待评/已评课程列表 | 读（教研室范围） | 读（授权教研室范围） | 读（全校筛选后） | 读（学院范围） | 读（全校范围） |
| 听课记录管理（互听任务） | - | - | - | 读/导出 | 读/编辑/导出 |
| 督导评教管理 | - | 读（本人） | 读（本人） | 读（学院） | 读/编辑（全校） |
| 统计（个人） | 读 | 读 | 读 | - | - |
| 统计（学院） | - | 读（督导口径） | 读（督导口径） | 读 | 读 |
| 统计（全校） | - | - | 读（督导口径） | - | 读 |

---

## 3. 界面与交互统一规范（所有端一致）

### 3.1 搜索与筛选

- **300ms 延迟自动搜索**：输入 300ms 后自动触发（debounce），无需额外点击搜索按钮也必须生效。
- **模糊搜索**：教师姓名、课程名称支持包含匹配。
- **多条件组合**：支持“学年 + 学期 + 校区 + 学院 + 周次 + 星期 + 节次 + 教师 + 课程名”的组合筛选。
- **条件联动**：上级条件变化时，清空/刷新下级选项（例如：学院变化后教师列表刷新）。
- **参数规范**：
  - 未选择条件时，不向后端传递空字符串 `""` / `null` / `undefined`。
  - 学期传值统一为 `1/2`（UI 可显示 春/秋，但传参必须为 1/2）。

### 3.2 加载态、空态与错误提示

- **加载态**：请求中必须显示加载态，避免“信息一直加载中”却无响应。
- **空态**：无数据时展示“暂无数据”的空态页面，并给出可操作建议（切换学期/放宽筛选）。
- **错误提示**：
  - 权限错误：提示“无权限”并引导联系管理员
  - 参数校验错误：提示具体字段与原因（例如 422 的字段定位）

### 3.3 日期/时间显示格式

- 日期：`YYYY-MM-DD`
- 时间：`HH:mm`
- 日期时间：`YYYY-MM-DD HH:mm`
- 不允许在 UI 直接展示 ISO 原始字符串：`2026-01-03T00:00:00`

### 3.4 课表周视图规范（来自截图标注）

- 顶部周视图标题：显示 `第X周`。
- 星期栏：仅显示 `一 二 三 四 五 六 日`，不出现“周一/周二”。
- 星期栏需展示对应日期（如 `01/03` 或 `2026-01-03`），并且**与当前周次对应**。
- 节次/时间轴：每个大节应对应具体时间段（例如：
  - 第1大节：8:30–9:15 / 9:20–10:05
  - 第2大节：...
  ）
  时间配置需全局统一，可维护。

### 3.5 评教详情展示规范（来自截图标注）

- 评教详情页必须展示：
  - 课程名称、授课教师、上课地点、上课时间（含周次/星期/节次）、听课日期时间、是否匿名
  - 评教业务编号（见 5.2）
- 评分展示：
  - 维度标题必须带“维度总分/满分”，例如：`教学态度（12/20分）`
  - 每个评分项后展示“得分/满分”，例如：`按时上、下课… 3/5`

### 3.6 身份切换（多重身份）

- 同一账号允许拥有多个身份：
  - 普通教师（教研室互评）
  - 院级督导
  - 校级督导

- **交互策略（你已确认）**：同一套页面刷新口径
  - 不做“不同身份不同菜单/不同页面”的分叉。
  - 切换身份后：保持在当前页面，仅刷新该页面的数据口径与默认筛选。

- 客户端必须提供“当前身份”切换入口（建议放在：首页/我的/评教模块顶部），并在切换后：
  - 刷新首页数量、待评/已评/收到/我的评教列表口径
  - 刷新统计页口径
  - 刷新筛选器默认值：
    - 普通教师：教研室固定为本人教研室
    - 院级督导：学院固定为本人学院；教研室可在授权集合内选择
    - 校级督导：校区/学院可筛选；默认不拉全量
  - 页面顶部必须展示当前身份标识（例如“当前身份：院级督导｜范围：信工学院-xx教研室”），避免用户误判数据范围。

- 身份切换不改变登录状态，只改变当前业务口径（active_identity）。

- **验收标准**：
  - 在任意页面切换身份后，页面不跳转、不重置路由；列表数据范围立即变化。
  - 院级督导身份下，所有列表/统计不可越权显示非授权教研室数据。

### 3.7 全局学年学期切换

- 学年/学期应支持“全局切换”（global_term），切换后影响：
  - 课表展示
  - 待评/已评/收到/我的评教列表
  - 首页数量
  - 统计页
- 全局学年/学期需要持久化（本地缓存），并在重新打开小程序后恢复。
- 各页面仍允许局部覆盖筛选，但默认使用全局值。


---

## 4. 功能需求

### 4.1 普通教师功能需求

#### 4.1.1 首页

- **功能编号**：T-Home-01
- **入口**：小程序首页
- **显示内容**：
  - 我的课表（当日/周）入口
  - 我的评教入口
  - 收到的评教入口
  - 个人统计入口
  - 个人信息入口
  - 待评课程数量
  - 已评课程数量
  - 总评数量
- **业务规则**：
  - 数量与列表必须随评教提交实时更新
  - 数量统计口径必须与筛选口径一致（默认学年学期/当前学期需明确）
- **验收标准**：
  - 提交一条评教后：待评 -1、已评 +1、总评 +1（同一统计口径下）

#### 4.1.2 我的课表（普通教师）

- **功能编号**：T-Schedule-01
- **入口**：底部 Tab「课表」
- **需求点**：
  - **无需搜索教师工号/账号**（普通教师默认只看本人课表）
  - 支持：按学年、学期查看；按周查看
  - 周视图 UI：
    - 顶部显示 `第X周`，支持上一周/下一周
    - 星期栏仅 `一 二 三 四 五 六 日`
    - 星期栏必须展示对应日期，并与周次对应
    - 每个大节展示对应时间段（可配置）
  - 课程点击进入课程详情
  - 课程详情字段必须包含：
    - 课程名称
    - 教师姓名
    - 上课地点
    - 上课时间（周次 + 星期 + 节次/大节）
    - 上课人数（新增）
    - 课程编号
    - 学年学期
    - 评教状态：空/待评/已评（与当前登录者联动）
- **验收标准**：
  - 课程详情字段不缺项；日期/时间格式符合 3.3

#### 4.1.2A 评教业务流程（选择 → 评教 → 记录）

- **功能编号**：C-Flow-01
- **目标**：评教流程必须闭环，且受“当前身份（active_identity）+ 全局学年学期（global_term）”控制。

**入口 A：从课表进入评教（推荐主路径）**

- 路径：课表（周视图/日历） → 课程详情 → 评教状态=待评 → 点击“去评教” → 评教提交页 → 提交成功 → 评教详情/已评列表
- 规则：
  - 课程详情必须能展示当前身份下的评教状态（空/待评/已评）
  - 若已评，则入口为“查看评教详情”，不得跳回提交页

**入口 B：从待评课程列表进入评教（辅助路径）**

- 路径：我的评教/督导评教 → 待评课程 → 选课程 → 评教提交页 → 提交成功 → 评教详情/已评列表

**提交流程与联动**

- 提交成功后必须触发联动刷新：
  - 待评列表减少
  - 已评/我提交的评教增加
  - 首页待评/已评/总评数量实时更新
- **身份切换后的口径**：
  - 切换身份后，待评/已评/统计口径必须立即变化（例如：普通教师仅教研室互评，校级督导为全校）。
- **全局学年学期切换后的口径**：
  - 切换全局学年学期后，课表与评教列表/统计必须一致（不得出现课表是 A 学期，评教列表却仍是 B 学期）。

#### 4.1.3 我的评教（普通教师）

模块页包含 4 个 Tab：
- 收到的评教
- 我提交的评教
- 待评课程
- 已评课程

##### 4.1.3.1 收到的评教

- **功能编号**：T-Eval-Rcv-01
- **入口**：我的评教 → 收到的评教
- **需求点**：
  - 可查看评价内容与评分
  - 可根据课程筛选（需保证能找到自己的课）
  - 显示被谁评教（支持匿名，按系统策略隐藏评教人信息）
  - 支持搜索（课程/评教人/日期至少其一）
- **验收标准**：
  - 匿名评教时：不展示评教人姓名/工号
  - 非匿名评教时：展示评教人信息

##### 4.1.3.2 我提交的评教（提交记录）

- **功能编号**：T-Eval-My-01
- **入口**：我的评教 → 我提交的评教
- **需求点**：
  - 列表仅展示：**课程名 + 授课教师姓名**
  - 评教编号显示方式需要调整：
    - 列表可不展示完整编号（避免冗长）
    - 详情页必须展示“业务编号”（见 5.2）
- **业务编号规则**：`校区-学院-日期-节次-教室编号`
- **验收标准**：
  - 列表不再以“时间随机号”作为主展示编号
  - 详情页展示业务编号，且日期/节次/教室编号取值正确

##### 4.1.3.3 待评课程（普通教师）

- **功能编号**：T-Eval-Pending-01
- **入口**：我的评教 → 待评课程
- **需求点**：
  - 仅展示本人所属教研室范围内授课教师的课程
  - 搜索栏必须可用（当前无响应需修复）
  - 支持按课程名称、教师名称模糊搜索
  - 列表项展示：课程名称、授课教师、上课时间（周次/星期/节次）、上课地点
  - 点击进入评教提交页
- **验收标准**：
  - 输入关键字后 300ms 自动触发过滤/查询
  - 不出现非本人所属教研室范围的课程

##### 4.1.3.4 已评课程

- **功能编号**：T-Eval-Done-01
- **入口**：我的评教 → 已评课程
- **需求点**：
  - 与“我提交的评教”数据联动
  - 支持搜索（课程名/教师名）
  - 点击可查看评教详情
  - 状态标识必须准确（避免“已评列表出现待评状态点/按钮”的混乱）
- **验收标准**：
  - 同一课程：提交后从待评消失，出现在已评
  - 已评列表不出现“待评按钮/待评状态点”

#### 4.1.4 评教提交页

- **功能编号**：T-Eval-Submit-01
- **入口**：待评课程点击进入
- **需求点（来自截图标注）**：
  - 顶部课程信息字段必须正确：课程名、授课教师、上课地点、上课时间
  - 上课时间必须包含：周次 + 星期 + 节次/大节（不能只显示“星期三 第五大节”但缺少周次）
  - 地点/教师信息不得长期停留在“加载中/未知教师”（要么正确展示，要么明确空值占位）
  - 评分维度与评分项展示符合 3.5
  - 必填项校验：
    - 评分项必须全部选择/填写
    - 文本项是否必填按配置
    - 匿名开关按系统策略
- **验收标准**：
  - 未填必填项不可提交，并提示缺失项
  - 提交成功后跳转到评教详情页/已评列表，首页数量实时更新

#### 4.1.5 评教详情页

- **功能编号**：T-Eval-Detail-01
- **入口**：我提交的评教/已评课程 → 详情
- **需求点**：
  - 顶部展示：课程名、授课教师、地点、上课时间
  - 展示听课日期时间（格式化，不出现 ISO 原串）
  - 展示听课时长、听课地点（如有）
  - 展示是否匿名
  - 展示业务编号（5.2）
  - 评分展示符合 3.5
- **验收标准**：
  - “评教编号”字段有值且符合规则
  - 日期时间展示符合 3.3

#### 4.1.6 统计（普通教师）

- **功能编号**：T-Stat-01
- **入口**：底部 Tab「统计」
- **需求点**：
  - 两个视角 Tab：
    - 我收到的评教（作为授课教师被评价）
    - 我提交的评教（作为听课教师提交评价）
  - 支持按学年、学期筛选，点击“查询”生效
  - 默认使用全局学年学期（global_term）作为口径
  - 若支持身份切换（active_identity），统计口径必须随身份切换：
    - 普通教师（教研室互评）：展示本人在“教研室互评身份”下可见的统计
    - 院级/校级督导：展示本人在“督导身份”下的统计（建议与普通教师分 Tab 或分入口）
  - 内容包含：
    - 数量统计（总次数/平均分/待审核等口径需明确）
    - 评分分布（等级或分数段）
    - 趋势图（必须标注时间粒度：按月/按周/按天）
    - 维度得分汇总（每维度得分与满分）
- **验收标准**：
  - 学期值展示为春/秋（或第1/2学期），但内部传值固定为 1/2
  - 趋势图口径清晰，不产生歧义

#### 4.1.7 个人中心

- **功能编号**：T-User-01
- **入口**：底部 Tab「我的」
- **需求点**：
  - 展示个人资料（姓名、工号/账号、学院、角色等）
  - 编辑资料（至少姓名；学院字段是否可编辑需明确）
  - 修改密码
- **验收标准**：
  - 保存后刷新可见

---

### 4.2 督导教师功能需求

#### 4.2.1 首页

- 与 T-Home-01 一致

#### 4.2.2 我的课表

- 与 T-Schedule-01 一致（默认仅本人课表）

#### 4.2.3 我的评教（督导）

- 与普通教师共用：收到的评教、我提交的评教、已评课程

#### 4.2.4 待评课程（督导重点模块）

- **功能编号**：S-Eval-Pending-01
- **目标**：督导可从授权范围内快速定位“当前要听评”的课程，避免全量列表不可用。

- **范围规则**：
  - 院级督导：仅本学院 + 被授权教研室
  - 校级督导：全校
  - 两者都必须“先筛选再展示”

**需求点 A：分级分类筛选**

- 校区 → 学院 → 周次 → 教师
- 筛选逻辑：
  - 校区默认选择（可修改默认校区）
  - 学院下拉
  - 周次选择
  - 教师列表根据“学院 + 周次”动态展示（只列出该周有课教师）

**需求点 B：按时间维度筛选（重点）**

- 时间（周次 + 星期） → 学院 → 自动列出当天该学院所有有课教师 → 选择教师 → 查看课程 → 评教
- 示例：第10周周一 → 信工学院 → 列出当天有课教师 → 点选教师 → 查看课程 → 填写评教

- **验收标准**：
  - 默认不拉取全校全周课程，必须先选择筛选条件
  - 选择“周次+星期+学院”后，教师列表为“当天有课教师”集合
  - 院级督导：教师与课程列表必须受“授权教研室集合”限制（不可越权看到非授权教研室教师课程）
  - 进入教师后，仅展示匹配时间范围内课程

#### 4.2.5 统计（督导）

- **功能编号**：S-Stat-01
- **入口**：统计页（在督导身份下）或单独的“督导统计”入口
- **需求点**：
  - 统计口径受 active_identity + global_term 控制：
    - 院级督导：本学院 + 授权教研室范围
    - 校级督导：全校范围
  - 内容至少包含：
    - 督导已评次数、平均分、等级分布
    - 可按学院/教研室筛选（院级督导学院固定）
    - 教师排名（按平均分/优秀率等，可配置）
  - 趋势口径必须标注时间粒度
- **验收标准**：
  - 切换身份后，统计范围立即变化
  - 院级督导不应看到非授权教研室数据


---

### 4.3 学院管理员功能需求

#### 4.3.1 首页

- **功能编号**：A-Home-01
- **入口**：管理员首页
- **需求点**：
  - 展示本学院维度的关键数据（来自后端统计接口）：
    - 本学期应听课总数（专任教师人数 × 4）
    - 已完成听课总数
    - 缺少听课总数
    - 本学院督导听课次数、平均分、等级分布（若有）
- **验收标准**：
  - 数据范围严格为本学院
  - 支持按学年/学期切换统计口径

#### 4.3.2 课表（学院管理员）

- **功能编号**：A-Schedule-01
- **入口**：课表/日历
- **需求点**：
  - 可查看本学院所有教师课表
  - 支持筛选：教师（建议提供：校区 → 学院（固定）→ 周次 → 教师 的分级筛选，替代“输入工号搜索”）
  - 支持按周次查看
  - 支持日历模式（来自截图的日历视图）
  - 课程详情字段同 T-Schedule-01，并额外展示：授课教师工号/账号（便于管理）
- **验收标准**：
  - 学院外教师不可见
  - 周视图日期与周次对应

#### 4.3.3 教师评教模块（管理员）

- **模块名称**：必须修改为 **教师评教**
- **模块包含**：
  - 教师听课记录（普通教师互评）
  - 收到的评教（督导评教）
  - 待评课程
  - 已评课程

##### 4.3.3.1 教师听课记录（普通教师互评）

- **功能编号**：A-TL-01
- **需求点**：
  - 查看本学院普通教师互听课记录
  - 每个教师一学期至少 4 次（任务约束）
  - 管理员可查看：
    - 每位教师已完成次数
    - 未完成教师列表
    - 缺少次数统计
  - 导出/下载（可选）：支持导出 Excel/CSV
- **验收标准**：
  - 能按学年/学期生成“完成情况清单”（教师维度汇总）
  - 能展示“缺少次数”并按缺少次数排序

##### 4.3.3.2 收到的评教（督导听课记录）

- **功能编号**：A-Eval-Rcv-01
- **需求点**：
  - 查看本学院教师收到的督导评教
  - 保留搜索栏与筛选按钮
  - 支持按：教师、课程、日期 搜索/筛选
  - 评教记录可查看详情（评分+内容+是否匿名等）
- **验收标准**：
  - 搜索栏 300ms 自动搜索生效
  - 筛选条件可组合（教师 + 日期范围 + 课程名）

##### 4.3.3.3 待评课程（学院管理员）

- **功能编号**：A-Eval-Pending-02
- **需求点**：学院管理员可从“本学院范围”查看待评课程，筛选方式两类：
  - A. 教研室 → 教师姓名（教研室范围在本学院内）
  - B. 周次 → 星期 → 节次（返回对应时间段所有课程）
- **验收标准**：
  - 两种筛选方式均可用，且条件联动正确

##### 4.3.3.4 已评课程（学院管理员）

- **功能编号**：A-Eval-Done-02
- **需求点**：
  - 查看本学院范围内已评课程记录（包含普通教师互评 + 督导评教）
  - 支持筛选与导出（可选）
  - 点击进入详情

#### 4.3.4 统计（学院管理员）

##### 4.3.4.1 教师听课记录统计

- **功能编号**：A-Stat-TL
- **需求点**：
  - 本学院专任教师总人数 × 4 = 本学期应听课总数
  - 实际完成多少、缺少多少
  - 未完成教师名单与缺少次数
- **验收标准**：
  - 统计口径与 A-TL-01 一致

##### 4.3.4.2 教师被听记录统计（督导结果统计）

- **功能编号**：A-Stat-Eval
- **需求点**：
  - 本学院被督导听课总次数
  - 最高分、最低分、平均分
  - 等级数量：优秀/良好/一般/合格/不合格
  - 对应等级教师名单
  - 本学院：普遍优点/普遍缺点（可从评语中聚合或手工维护，需确认实现方式）
  - 全校维度：各学院平均分排名；本学院排名
  - 展示学院所有专任教师排名（按平均分）


---

### 4.4 学校管理员功能需求

#### 4.4.1 课表（学校管理员）

- **功能编号**：U-Schedule-01
- **需求点**：
  - 查看全校所有教师课表
  - 可按学院筛选
  - 支持周次查看、日历模式
- **验收标准**：
  - 全校可见，但筛选必须可用（避免全量列表不可用）

#### 4.4.2 教师评教（学校管理员）

模块包含：教师听课记录（全校）、督导评教（全校）、待评课程、已评课程。

##### 4.4.2.1 教师听课记录（全校）

- **功能编号**：U-TL
- **需求点**：
  - 查看全校教师互听课记录
  - 支持编辑（用于纠错/补录/异常修正）
  - 支持按学院/教师/学年学期筛选
- **验收标准**：
  - 编辑有审计字段（谁改的、改了什么、什么时候）或至少记录操作日志（需确认实现）

##### 4.4.2.2 督导评教（全校）

- **功能编号**：U-Eval-Super
- **需求点**：
  - 查看、编辑所有督导评教记录
  - 分类/筛选方式：
    - 原有分类（学院、课程、时间等）
    - 新增：按督导姓名分类
- **验收标准**：
  - 按督导姓名筛选后结果正确

##### 4.4.2.3 待评课程（全校）

- **功能编号**：U-Eval-Pending
- **需求点**：
  - 展示全校范围未被评教的课程
  - 可设置分类方式：时间/学院/教师
  - 默认必须先筛选再展示（防止全量过大）

##### 4.4.2.4 已评课程（全校）

- **功能编号**：U-Eval-Done
- **需求点**：
  - 查看全校被评教过的课程
  - 支持筛选与导出
  - 可查看详情

#### 4.4.3 统计（学校管理员）

##### 4.4.3.1 教师听课记录（全校）

- **功能编号**：U-Stat-TL
- **需求点**：同 A-Stat-TL，但统计范围为全校

##### 4.4.3.2 教师被听记录（督导评教全校统计）

- **功能编号**：U-Stat-Eval
- **需求点**：
  - 全校被督导听课总次数
  - 最高分、最低分、平均分
  - 评教等级分布与各等级教师
  - 全校普遍优点/缺点
  - 全校学院平均分排名
  - 优秀率排名
  - 全校所有教师排名（按得分）


---

## 5. 系统共性需求

### 5.1 评教表单结构需求

- **评分项结构**：维度（Dimension）→ 评分项（Item）
- **每项包含**：
  - 评分上限/权重（例如 5 分、10 分）
  - 评分说明文本（帮助评教人理解标准）
- **匿名策略**：
  - 系统可配置“是否允许匿名”
  - 若评教人选择匿名：在“收到的评教/管理端查看”中隐藏评教人身份（至少对授课教师隐藏；管理员是否可见需确认）
- **必填校验**：
  - 所有评分项必须给分
  - 文本项（优点/问题/建议）是否必填由配置决定
  - 听课日期、听课时长、听课地点等字段是否必填由配置决定
- **评分总分与等级**：
  - 需定义“总分 → 等级”的映射（优秀/良好/一般/合格/不合格）
  - 映射规则必须在系统配置中可维护

### 5.2 评教编号（业务编号）生成规则

- **目标**：替代当前“随机/时间流水号”的主展示方式，用可读业务编号在详情页展示。
- **格式**：`校区-学院-日期-节次-教室编号`
- **字段规则**：
  - 校区：`1=南宁`，`2=桂林`
  - 学院：每学院一个编号（需维护映射表）
  - 日期：`YYYYMMDD`（建议取“听课日期”，不是提交时间；需确认最终口径）
  - 节次：`01-12`（由“大节/节次”映射成序号，需统一映射表）
  - 教室编号：强智教务系统教室编号（截图示例：`计算机基础实验室5 (4522)`，括号内 `4522`）
- **展示规则**：
  - 列表页：仅展示“课程名 + 授课教师姓名”（编号可不展示）
  - 详情页：必须展示业务编号

### 5.3 课表数据结构要求

- 支持按周次渲染
- 一天多节次/大节
- 每节次可包含多个班（合班）
- 节次时间固定配置（全局统一，可维护）
- 课程详情字段至少包含：
  - 课程名称、课程编号
  - 授课教师（姓名/账号）
  - 上课地点（含教室编号）
  - 上课时间（学年学期、周次、星期、节次/大节、时间段）
  - 上课人数

### 5.4 搜索与筛选统一规范（补充）

- 支持分页
- 默认排序必须稳定（建议：学年学期降序 + 星期/节次升序）
- 需要支持“仅展示当前学期/当前周”的默认视图，避免历史数据过多导致不可用


---

## 6. 数据与接口需求（概要）

> 本章用于对齐“前端需要什么字段/后端必须提供什么能力”。接口路径可按现有后端实现调整，本章不强绑具体 URL，但强绑字段与口径。

### 6.1 核心数据对象

#### 6.1.1 用户（User）

- 关键字段需求：
  - 用户唯一标识（id）
  - 登录账号（工号/账号）
  - 姓名
  - 所属校区
  - 所属学院（college_id）
  - 角色（普通教师/督导/学院管理员/学校管理员）
- UI 要求：
  - 个人中心、列表、详情中使用“姓名”作为主展示
  - 账号/工号用于辅助信息展示或管理员检索

#### 6.1.2 课表（Timetable）

- 关键字段需求（用于页面展示与筛选）：
  - id
  - 学年 academic_year（如 2025-2026）
  - 学期 semester（1/2）
  - 课程名称 course_name
  - 课程编号 course_code
  - 授课教师 teacher_id + teacher_name
  - 班级/上课对象 class_name（可能合班）
  - 上课地点 classroom（必须支持展示教室编号，例如 “xx(4522)”）
  - 周次信息 week_info（可渲染周次、可用于筛选周次）
  - 星期 weekday（一..日 1..7） + weekday_text（可选）
  - 节次/大节 period（例如 第五大节）
  - 节次时间 section_time（例如 8:30–9:15 / 9:20–10:05）
  - 上课人数 student_count（新增，若数据源缺失需允许为空，但 UI 需给出占位）
  - 评教状态（对当前登录者）：空/待评/已评

#### 6.1.3 评教记录（Evaluation）

- 关键字段需求：
  - id
  - 评教业务编号（见 5.2）
  - timetable_id
  - 授课教师 teacher_id
  - 听课教师/评教人 listen_teacher_id
  - 听课日期 listen_date（必须可格式化展示）
  - 提交时间 submit_time
  - 是否匿名 is_anonymous
  - 总分 total_score
  - 等级 score_level（优秀/良好/一般/合格/不合格）
  - 维度得分 dimension_scores（维度总分展示必需）
  - 评分项得分 item_scores（每项得分/满分展示必需）
  - 评语：优点/问题/建议
  - 审核/有效状态（若引入审核流程）

### 6.2 必要配置项（必须可维护）

- 校区编码映射：`1=南宁`，`2=桂林`
- 学院编号映射（用于业务编号）：每学院一个编号
- 节次/大节编号映射：`01-12`（用于业务编号）
- 节次时间配置：每个大节对应具体时间段（用于课表时间轴与详情展示）
- 总分到等级映射（优秀/良好/一般/合格/不合格的阈值）
- 匿名策略：
  - 是否允许匿名
  - 匿名后“授课教师/管理员/学校管理员”各自是否可见评教人身份（需明确）

- 身份与范围配置：
  - 用户所属教研室 research_room_id（用于普通教师互评范围）
  - 院级督导授权范围（可配置多个教研室）
  - 校级督导标识（是否拥有校级督导身份）

### 6.3 接口能力清单（按功能）

#### 6.3.1 认证与用户

- 登录
- 获取当前用户信息（含角色、校区、学院）
- 修改密码
- 编辑个人资料（至少姓名；学院字段是否可编辑需明确）

- 获取当前用户可用身份列表（用于身份切换）
- 切换当前身份（设置 active_identity）
- 获取当前身份的评教范围摘要（用于页面展示“当前范围：xx教研室/xx学院/全校”）

#### 6.3.2 课表

- 获取个人课表（按学年/学期/周次）
- 获取教师课表（学院管理员/学校管理员，按教师/学院/周次筛选）
- 获取课表详情（必须返回：teacher_name、classroom、week_info、weekday、period/section_time、student_count、course_code）

#### 6.3.3 评教

- 获取待评课程列表
  - 必须支持：按课程名/教师名模糊搜索
  - 必须支持：按学年/学期/周次/学院/教师筛选（督导/管理员）
  - 必须返回：teacher_name、classroom、周次/星期/节次信息
- 提交评教
  - 必须校验必填项
  - 提交成功后返回评教记录 id/编号
- 获取我提交的评教列表（支持筛选与分页）
- 获取收到的评教列表（支持筛选与分页、匿名策略）
- 获取评教详情（必须返回：业务编号、格式化日期时间、维度/评分项得分与满分）

#### 6.3.4 统计

- 个人统计：我收到的评教 / 我提交的评教
  - 按学年/学期筛选
  - 数量、分布、趋势、维度得分汇总
- 学院统计（学院管理员）
  - 听课任务完成度统计
  - 督导结果统计（等级分布、排名、共性优缺点）
- 全校统计（学校管理员）
  - 同学院口径，但范围扩大到全校

#### 6.3.5 管理（管理员）

- 学院管理员：听课记录清单、未完成清单、导出
- 学校管理员：全校听课记录查看/编辑、督导评教查看/编辑、导出

### 6.4 数据口径与一致性

- 待评/已评判断口径必须统一：以“评教记录是否存在”判定（同一评教人 + 同一课表）。
- 同一评教人对同一课表的重复评教策略需明确：
  - 默认：同一天只能评一次（如需允许多次，必须增加业务字段区分）。
- 统计口径需明确“时间范围”：
  - 学年/学期为主
  - 周次/月份趋势为辅


---

## 7. 非功能性需求

### 7.1 性能

- 列表类接口（课表/待评/已评/收到/我的评教）：在常规数据量下应在 2 秒内返回。
- 搜索：输入后 300ms debounce，接口返回与渲染总体不超过 1.5 秒。

### 7.2 安全与权限

- 必须实现基于角色的访问控制（RBAC）。
- 管理端“编辑”类操作必须有权限校验。
- 评教匿名必须严格生效（避免通过详情/导出泄露评教人身份）。

### 7.3 可用性

- 所有页面必须具备：加载态、空态、错误提示。
- 关键信息不得长期停留在“加载中”。

### 7.4 可维护性

- 关键映射（校区/学院编号/节次时间/等级阈值）必须可配置，而非写死在前端。
- 统计口径变更需能通过配置或明确的后端参数控制。


---

## 8. 验收与测试要点

> 以功能编号为主线，验收时逐项打勾。

### 8.1 UI 与交互验收

- T-Schedule-01：周视图星期栏仅显示“一..日”，且显示日期并与周次对应。
- T-Eval-Submit-01：提交页顶部信息完整且不为空（课程/教师/地点/时间含周次）。
- T-Eval-Detail-01：详情页“评教编号”不为空；日期时间格式化；维度/评分项得分展示正确。
- T-Eval-Pending-01：搜索栏 300ms 自动搜索可用；可按课程名/教师名搜索。
- T-Stat-01：趋势图标注时间粒度；维度得分汇总展示。

### 8.2 权限与数据范围验收

- 普通教师：不可见跨学院待评课程。
- 督导：可跨学院，但必须先筛选再展示。
- 学院管理员：仅本学院范围。
- 学校管理员：全校范围；可按学院筛选。

### 8.3 数据一致性验收

- 提交评教后：待评列表减少、已评/我的评教增加、首页数量同步更新。
- 已评课程点击进入“评教详情”（不得进入提交页）。


---

## 9. 风险、假设与待确认项

### 9.1 风险

- 数据源缺失导致字段为空（教室编号、上课人数、周次信息等），将直接影响业务编号生成与 UI 展示。
- 全校数据量较大，若不做“先筛选再展示”，督导/学校管理员页面会不可用。

### 9.2 假设

- 课表数据具备可解析的周次信息（week_info），可映射到具体周次集合。
- 教室信息中能获得“教室编号”（例如括号中的 4522）。

### 9.3 待确认项（需要你拍板）

- 业务编号中“日期”取值：听课日期 vs 上课日期 vs 提交日期（推荐：听课日期）。
- 匿名策略：匿名后，管理员/学校管理员是否仍可见评教人身份？
- “教务处老师”是否作为新角色，还是等同于“学校管理员”的 UI 命名？
- 听课任务“每学期至少 4 次”的口径：
  - 是否仅统计“互听”（普通教师提交）
  - 是否包含督导提交
  - 是否仅统计有效/通过的记录
- 导出格式（Excel/CSV）、字段清单与模板。


---

## 10. 开发进度同步单（迭代计划）

### 10.1 推荐迭代拆分

- **迭代 1（教师端 MVP 闭环）**：T-Home-01、T-Schedule-01、T-Eval-Pending-01、T-Eval-Submit-01、T-Eval-My-01、T-Eval-Rcv-01、T-Eval-Done-01、T-Eval-Detail-01
- **迭代 2（教师端统计完善）**：T-Stat-01、编号规则落地（5.2）、趋势/维度展示完善
- **迭代 3（督导筛选与评教）**：S-Eval-Pending-01（分级筛选 + 时间筛选）
- **迭代 4（学院管理员）**：A-Schedule-01、A-TL-01、A-Stat-TL、A-Stat-Eval、A-Eval-Rcv-01、A-Eval-Pending-02
- **迭代 5（学校管理员）**：U-Schedule-01、U-TL、U-Eval-Super、U-Eval-Pending、U-Eval-Done、U-Stat-TL、U-Stat-Eval

### 10.2 开发进度同步单（可直接复制到表格）

| 功能编号 | 模块 | 需求摘要 | 优先级 | 依赖/前置 | 后端 | 前端 | 测试 | 状态 | 计划开始 | 计划完成 | 实际完成 | 备注 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| C-Term-01 | 通用 | 全局学年学期切换（影响课表/评教/统计/首页口径） | P0 | 全局状态管理 | - | 已完成未验证 | - | 已完成未验证 |  |  |  | 同步组 G0 |
| C-Identity-01 | 通用 | 身份切换（普通/院级督导/校级督导，多身份共存） | P0 | 用户身份与范围配置 | - | 已完成未验证 | - | 已完成未验证 |  |  |  | 同步组 G0 |
| C-Scope-01 | 通用 | 评教范围规则：普通=教研室；院督导=授权教研室；校督导=全校 | P0 | 范围配置与校验 | 已完成未验证 | 已完成未验证 | - | 已完成未验证 |  |  |  | 同步组 G0 |
| T-Schedule-01 | 课表 | 个人课表周视图（星期+日期+节次时间）与详情弹窗 | P0 | C-Term-01 | - | 已完成未验证 | - | 已完成未验证 |  |  |  | 同步组 G1 |
| T-Eval-Pending-01 | 我的评教 | 待评课程（教研室范围+搜索） | P0 | C-Term-01、C-Scope-01 | 已完成未验证 | 已完成未验证 | - | 已完成未验证 |  |  |  | 同步组 G1 |
| T-Eval-Submit-01 | 评教 | 提交页信息完整（教师/地点/周次）+必填校验 | P0 | T-Schedule-01、C-Term-01 | 已完成未验证 | 已完成未验证 | - | 已完成未验证 |  |  |  | 同步组 G1 |
| T-Eval-Detail-01 | 评教 | 详情页编号不为空+日期格式化+得分展示 | P0 | T-Eval-Submit-01 | 已完成未验证 | 已完成未验证 | - | 已完成未验证 |  |  |  | 同步组 G1 |
| T-Eval-My-01 | 我的评教 | 我提交的评教列表（课程+教师，编号进详情） | P0 | T-Eval-Submit-01、C-Term-01 | 已完成未验证 | 已完成未验证 | - | 已完成未验证 |  |  |  | 同步组 G2 |
| T-Eval-Done-01 | 我的评教 | 已评课程（与我的评教联动，点击进详情） | P0 | T-Eval-My-01 | 已完成未验证 | 已完成未验证 | - | 已完成未验证 |  |  |  | 同步组 G2 |
| T-Home-01 | 首页 | 首页看板与数量实时更新 | P0 | T-Schedule-01、T-Eval-Pending-01、T-Eval-My-01 | - | 已完成未验证 | - | 已完成未验证 |  |  |  | 同步组 G2 |
| C-Flow-01 | 通用 | 评教流程闭环（课表/待评 → 提交 → 详情/记录 → 统计联动） | P0 | G1/G2 联动验收 | 已完成未验证 | 已完成未验证 | - | 已完成未验证 |  |  |  | 同步组 G2（集成验收项） |
| T-Eval-Rcv-01 | 我的评教 | 收到的评教（匿名策略+搜索） | P1 | T-Eval-Submit-01、C-Term-01 | 已完成未验证 | 已完成未验证 | - | 已完成未验证 |  |  |  | 同步组 G3 |
| T-Stat-01 | 统计 | 我收到/我提交统计（趋势口径明确+维度汇总） | P1 | T-Eval-Submit-01、C-Term-01 | 已完成未验证 | 已完成未验证 | - | 已完成未验证 |  |  |  | 同步组 G3 |
| T-User-01 | 我的 | 个人资料/编辑/改密 | P1 | C-Identity-01 | 已完成未验证 | 已完成未验证 | - | 已完成未验证 |  |  |  | 同步组 G3 |
| S-Eval-Pending-01 | 督导 | 校区→学院→周次→教师 + 周次星期驱动筛选 | P1 | C-Identity-01、C-Term-01、C-Scope-01 | 已完成未验证 | 已完成未验证 | - | 已完成未验证 |  |  |  | 同步组 G4 |
| S-Stat-01 | 督导 | 督导统计（院级=授权教研室；校级=全校；随身份/学期联动） | P1 | C-Identity-01、C-Term-01、C-Scope-01、T-Eval-Submit-01 | 已完成未验证 | 已完成未验证 | - | 已完成未验证 |  |  |  | 同步组 G4 |
| A-Schedule-01 | 学院管理员 | 学院课表（教师筛选+周次+日历） | P1 | C-Term-01、C-Scope-01 | 已完成未验证 | 已完成未验证 | - | 已完成未验证 |  |  |  | 同步组 G5 |
| A-TL-01 | 学院管理员 | 听课记录完成度清单（×4 次）+导出（可选） | P1 | T-Eval-Submit-01、C-Term-01 | 已完成未验证 | 已完成未验证 | - | 已完成未验证 |  |  |  | 同步组 G5 |
| A-Stat-TL | 学院管理员 | 听课记录统计（应听/完成/缺少/名单） | P1 | A-TL-01 | 已完成未验证 | 已完成未验证 | - | 已完成未验证 |  |  |  | 同步组 G5 |
| A-Stat-Eval | 学院管理员 | 督导结果统计（等级分布/排名/共性优缺点） | P2 | S-Stat-01、统计口径确认 | 已完成未验证 | 已完成未验证 | - | 已完成未验证 |  |  |  | 同步组 G5 |
| U-Schedule-01 | 学校管理员 | 全校课表（按学院筛选） | P2 | C-Term-01 | 已完成未验证 | 已完成未验证 | - | 已完成未验证 |  |  |  | 同步组 G6 |
| U-TL | 学校管理员 | 全校听课记录查看/编辑 | P2 | T-Eval-Submit-01、C-Term-01 | 已完成未验证 | 已完成未验证 | - | 已完成未验证 |  |  |  | 同步组 G6 |
| U-Eval-Pending | 学校管理员 | 全校待评（时间/学院/教师分类） | P2 | C-Term-01、C-Scope-01 | 已完成未验证 | 已完成未验证 | - | 已完成未验证 |  |  |  | 同步组 G6 |
| U-Eval-Done | 学校管理员 | 全校已评（筛选+导出） | P2 | T-Eval-Submit-01、C-Term-01 | 已完成未验证 | 已完成未验证 | - | 已完成未验证 |  |  |  | 同步组 G6 |
| U-Eval-Super | 学校管理员 | 督导评教查看/编辑 + 按督导姓名分类 | P2 | S-Eval-Pending-01、S-Stat-01 | 已完成未验证 | 已完成未验证 | - | 已完成未验证 |  |  |  | 同步组 G6 |
| U-Stat-TL | 学校管理员 | 全校听课统计 | P2 | A-Stat-TL | 已完成未验证 | 已完成未验证 | - | 已完成未验证 |  |  |  | 同步组 G6 |
| U-Stat-Eval | 学校管理员 | 全校督导统计（排名/优秀率） | P2 | S-Stat-01、统计口径确认 | 已完成未验证 | 已完成未验证 | - | 已完成未验证 |  |  |  | 同步组 G6 |


